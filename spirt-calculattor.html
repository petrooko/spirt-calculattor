<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Alcohol Calculator</title>
<link rel="manifest" href="manifest.json">
<style>
*{box-sizing:border-box}
html,body{margin:0;overflow-x:hidden;font-family:system-ui,sans-serif;transition:.3s;}
:root{
  --bg:linear-gradient(120deg,#0f2027,#203a43,#2c5364);
  --card:rgba(0,0,0,0.35);
  --text:white;
  --btn:#00c853;
  --danger:#ff5252;
  --panel:rgba(255,255,255,0.12);
}
.light{
  --bg:linear-gradient(120deg,#e0e0e0,#f5f5f5);
  --card:white;
  --text:#000;
  --panel:#ddd;
}
body{background:var(--bg);color:var(--text);}
.app{max-width:600px;margin:auto;padding:15px;}
header{display:flex;justify-content:space-between;align-items:center;font-size:24px;font-weight:700;margin-bottom:10px;flex-wrap:wrap;}
.theme, #installBtn{padding:6px 12px;border-radius:10px;background:var(--panel);border:none;margin-top:5px;}
.tabs{display:flex;background:var(--panel);border-radius:12px;overflow:hidden;}
.tabs button{flex:1;padding:14px;background:none;border:none;font-size:16px;color:var(--text);}
.tabs button.active{background:var(--card);}
.panel{display:none;margin-top:15px;}
.panel.active{display:block;}
input, select{width:100%;padding:14px;margin:8px 0;border-radius:12px;border:none;font-size:18px;}
button.calc{width:100%;background:var(--btn);color:white;font-size:18px;padding:14px;border:none;border-radius:12px;margin-top:8px;}
button.clear{width:100%;background:var(--danger);color:white;font-size:18px;padding:14px;border:none;border-radius:12px;margin-top:8px;}
.result{opacity:0;transform:scale(.98);transition:.36s;margin-top:12px;background:var(--card);border-radius:12px;padding:15px;font-size:20px;text-align:center;}
.result.show{opacity:1;transform:scale(1);}
.small{font-size:13px;color:rgba(255,255,255,0.7);margin-top:6px;}
@media (max-width:480px){ .app{padding:12px;} input, select{font-size:16px;padding:12px} button.calc,button.clear{padding:12px;font-size:16px} }
</style>
</head>
<body>

<div class="app">
<header>
  Alcohol Calculator
  <div style="display:flex;gap:10px;flex-wrap:wrap">
    <button class="theme" onclick="toggleTheme()">üåó –¢–µ–º–∞</button>
    <button id="installBtn" style="display:none;">üì≤ –î–æ–¥–∞—Ç–∏ —è–∫ –¥–æ–¥–∞—Ç–æ–∫</button>
  </div>
</header>

<div class="tabs">
  <button class="active" onclick="tab(0)">–í–æ–¥–∞</button>
  <button onclick="tab(1)">–ê–µ—Ä–æ–º–µ—Ç—Ä</button>
  <button onclick="tab(2)">–ë—Ä–∞–≥–∞</button>
</div>

<!-- –í–û–î–ê -->
<div class="panel active">
  <input type="number" inputmode="decimal" id="c1" placeholder="–ü–æ—á–∞—Ç–∫–æ–≤–∞ –º—ñ—Ü–Ω—ñ—Å—Ç—å %">
  <input type="number" inputmode="decimal" id="v1" placeholder="–û–± º—î–º –ª">
  <input type="number" inputmode="decimal" id="c2" placeholder="–ü–æ—Ç—Ä—ñ–±–Ω–∞ –º—ñ—Ü–Ω—ñ—Å—Ç—å %">
  <button class="calc" onclick="water()">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
  <button class="clear" onclick="clearAll()">–û—á–∏—Å—Ç–∏—Ç–∏</button>
  <div class="result" id="rWater"></div>
</div>

<!-- –ê–ï–†–û–ú–ï–¢–† -->
<div class="panel">
  <select id="aspType">
    <option value="asp1">–ê–°–ü-1</option>
    <option value="asp2">–ê–°–ü-2</option>
    <option value="asp3" selected>–ê–°–ü-3 (20¬∞C)</option>
  </select>

  <input type="number" inputmode="decimal" id="aVal" placeholder="–ü–æ–∫–∞–∑ –∞–µ—Ä–æ–º–µ—Ç—Ä–∞ %">
  <input type="number" inputmode="decimal" id="tVal" placeholder="–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ ¬∞C">

  <button class="calc" onclick="calcAero()">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
  <button class="clear" onclick="clearAll()">–û—á–∏—Å—Ç–∏—Ç–∏</button>
  <div class="result" id="rAero"></div>
</div>

<!-- –ë–†–ê–ì–ê -->
<div class="panel">
  <input type="number" inputmode="decimal" id="og" placeholder="OG (–ê–¶-2)">
  <input type="number" inputmode="decimal" id="fg" placeholder="FG (–ê–¶-2)">
  <input type="number" inputmode="decimal" id="vol" placeholder="–û–± º—î–º –±—Ä–∞–≥–∏ –ª">
  <div class="small">–§–æ—Ä–º—É–ª–∞ ABV ‚âà (OG ‚àí FG) √ó 0.5083</div>
  <button class="calc" onclick="braga()">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
  <button class="clear" onclick="clearAll()">–û—á–∏—Å—Ç–∏—Ç–∏</button>
  <div class="result" id="rBraga"></div>
</div>

</div>

<script>
// Tabs
function tab(n){
 document.querySelectorAll('.tabs button').forEach((b,i)=>b.classList.toggle("active",i===n));
 document.querySelectorAll('.panel').forEach((p,i)=>p.classList.toggle("active",i===n));
}

// Fade helper
function show(el, txt){
 el.classList.remove("show");
 setTimeout(()=>{
   el.innerHTML = txt;
   el.classList.add("show");
   el.scrollIntoView({behavior:"smooth", block:"center"});
 },80);
}

// –í–û–î–ê
function water(){
 const c1v = parseFloat(document.getElementById('c1').value);
 const v = parseFloat(document.getElementById('v1').value);
 const c2v = parseFloat(document.getElementById('c2').value);
 if(!isFinite(c1v)||!isFinite(v)||!isFinite(c2v) || c1v<=0 || v<=0 || c2v<=0 || c2v>=c1v){
   show(rWater,'–ü–æ–º–∏–ª–∫–∞ ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä –≤—Ö—ñ–¥–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è');
   return;
 }
 const final = v * c1v / c2v;
 const add = final - v;
 show(rWater,
   '–î–æ–¥–∞—Ç–∏ –≤–æ–¥–∏: <strong>' + add.toFixed(2) + ' –ª</strong><br>' +
   '–ö—ñ–Ω—Ü–µ–≤–∏–π –æ–± º—î–º: <strong>' + final.toFixed(2) + ' –ª</strong>'
 );
}

// –ê–ï–†–û–ú–ï–¢–†
function calcAero(){
  const measured = parseFloat(document.getElementById('aVal').value);
  const temp = parseFloat(document.getElementById('tVal').value);
  const aspType = document.getElementById('aspType').value;
  const resDiv = document.getElementById('rAero');

  if(isNaN(measured) || isNaN(temp)){
    show(resDiv,"–ü–æ–º–∏–ª–∫–∞ ‚Äî –≤–≤–µ–¥–∏ –ø–æ–∫–∞–∑ —ñ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É");
    return;
  }

  let factor = 0.0165; // –ê–°–ü-3
  if(aspType === "asp1") factor = 0.015;
  if(aspType === "asp2") factor = 0.0155;
  if(aspType === "asp3") factor = 0.0165;

  const corrected = measured * (1 - factor * (temp - 20));

  show(resDiv,
    "–¢–∏–ø: <b>" + aspType.toUpperCase() + "</b><br>" +
    "–ü—Ä–∏–≤–µ–¥–µ–Ω–æ –¥–æ 20¬∞C: <b>" + corrected.toFixed(2) + " %</b>"
  );
}

// –ë–†–ê–ì–ê
function braga(){
 const O = parseFloat(document.getElementById('og').value);
 const F = parseFloat(document.getElementById('fg').value);
 const V = parseFloat(document.getElementById('vol').value);
 if(!isFinite(O) || !isFinite(F) || !isFinite(V) || O<=F || V<=0){
   show(rBraga,'–ü–æ–º–∏–ª–∫–∞ ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä OG, FG —Ç–∞ –æ–± º—î–º (OG > FG)');
   return;
 }

 const COEF = 0.5083;
 const abv = (O - F) * COEF;
 const absoluteLiters = V * (abv / 100);
 const raw40 = absoluteLiters / 0.40;
 const raw43 = absoluteLiters / 0.43;

 show(rBraga,
   'ABV –±—Ä–∞–≥–∏: <strong>' + abv.toFixed(3) + ' %</strong><br>' +
   '–ê–±—Å–æ–ª—é—Ç–Ω–∏–π —Å–ø–∏—Ä—Ç: <strong>' + absoluteLiters.toFixed(2) + ' –ª</strong><br>' +
   '–°–∏—Ä–µ—Ü—å 40%: <strong>' + raw40.toFixed(2) + ' –ª</strong><br>' +
   '–°–∏—Ä–µ—Ü—å 43%: <strong>' + raw43.toFixed(2) + ' –ª</strong>'
 );
}

// –û—á–∏—Å—Ç–∏—Ç–∏
function clearAll(){
 document.querySelectorAll('input').forEach(i=>i.value='');
 document.querySelectorAll('.result').forEach(r=>{ r.innerHTML=''; r.classList.remove('show'); });
}

// Theme toggle + persist
function toggleTheme(){
 document.body.classList.toggle('light');
 localStorage.theme = document.body.classList.contains('light') ? 'light' : 'dark';
}
if(localStorage.theme === 'light') document.body.classList.add('light');

// Service worker (PWA)
if('serviceWorker' in navigator){
 navigator.serviceWorker.register('sw.js').catch(()=>{});
}

// PWA Install button
let deferredPrompt;
const installBtn = document.getElementById('installBtn');
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = 'inline-block';
});
installBtn.addEventListener('click', async () => {
  if (!deferredPrompt) return;
  deferredPrompt.prompt();
  const { outcome } = await deferredPrompt.userChoice;
  deferredPrompt = null;
  installBtn.style.display = 'none';
});
</script>

</body>
</html>